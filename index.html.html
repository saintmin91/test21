<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>이미지 스크롤 뷰어 · 단일 HTML</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --panel:#111827;/* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --text:#e5e7eb; /* gray-200 */
      --accent:#60a5fa; /* blue-400 */
      --accent-2:#38bdf8; /* sky-400 */
      --border:#1f2937; /* gray-800 */
      --ok:#10b981; /* emerald-500 */
      --warn:#f59e0b;/* amber-500 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, var(--bg), #0b1220 60%);
      color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(8px);
      background:rgba(15,23,42,0.7); border-bottom:1px solid var(--border);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:16px;}
    h1{margin:0; font-weight:800; letter-spacing:-0.02em}
    .sub{color:var(--muted); font-size:14px}

    .controls{display:grid; grid-template-columns:1fr auto; gap:12px; margin-top:12px}
    .panel{background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:12px}
    .uploader{display:flex; gap:12px; align-items:center; flex-wrap:wrap}

    .dropzone{
      flex:1; min-height:110px; display:flex; align-items:center; justify-content:center;
      border:2px dashed #22304a; border-radius:16px; background:rgba(96,165,250,0.05);
      text-align:center; padding:12px; transition: all .2s ease;
    }
    .dropzone.highlight{border-color:var(--accent); background:rgba(56,189,248,0.08)}
    .dropzone p{margin:6px 0 0; color:var(--muted)}

    .btn{
      display:inline-flex; align-items:center; gap:8px; border:1px solid var(--border);
      background:#0b1220; color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer; text-decoration:none;
      transition:.15s transform ease, .15s opacity ease;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#00111a; font-weight:700; border:none}
    .btn.ghost{background:transparent}

    .tools{display:flex; gap:8px; flex-wrap:wrap}

    .gallery{max-width:1100px; margin:20px auto; display:flex; flex-direction:column; gap:16px; padding:0 16px 36px}
    .item{background:var(--panel); border:1px solid var(--border); border-radius:18px; overflow:hidden}
    .meta{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 12px; border-bottom:1px dashed var(--border); color:var(--muted); font-size:13px}
    .meta .left{display:flex; gap:10px; align-items:center; min-width:0}
    .name{white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:60vw}
    .preview{display:block; width:100%; height:auto; background:#000;}
    .actions{display:flex; gap:6px}

    .footer-tip{color:var(--muted); text-align:center; font-size:12px; padding:16px}
    .hidden{display:none}

    @media (max-width:600px){
      .controls{grid-template-columns:1fr}
      .name{max-width:48vw}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>이미지 스크롤 뷰어</h1>
      <div class="sub">이미지를 업로드하면 아래로 쭉 스크롤하며 볼 수 있어요. <strong>“HTML로 내보내기”</strong>를 누르면 이미지가 포함된 하나의 파일로 저장되어, 그 파일만 보내면 누구나 브라우저에서 볼 수 있습니다.</div>
      <div class="controls">
        <div class="panel">
          <div class="uploader">
            <label class="btn" for="file-input">파일 선택</label>
            <input id="file-input" type="file" accept="image/*" multiple class="hidden" />
            <button class="btn ghost" id="clear-all" title="모든 항목 제거">전체 비우기</button>
            <div class="tools">
              <select id="sort-select" class="btn ghost" title="정렬">
                <option value="added">정렬: 업로드순</option>
                <option value="name">정렬: 이름순</option>
                <option value="size">정렬: 파일크기순</option>
              </select>
              <button class="btn ghost" id="toggle-captions">파일 정보 숨기기</button>
            </div>
          </div>
          <div id="dropzone" class="dropzone" tabindex="0" role="button" aria-label="이미지 끌어다 놓기 영역">
            <div>
              <div style="font-weight:700">여기로 이미지를 끌어다 놓거나, 위의 “파일 선택”을 클릭</div>
              <p>PNG, JPG, GIF, WEBP 등. 여러 장을 한 번에 올릴 수 있어요.</p>
            </div>
          </div>
        </div>
        <div class="panel" style="display:flex; flex-direction:column; gap:8px; align-items:stretch; justify-content:space-between">
          <button class="btn primary" id="export-html">HTML로 내보내기</button>
          <small class="sub">내보낸 파일은 이미지가 <em>내장</em>되어 있어 인터넷 없이도 열리고, 메신저/메일로 그대로 공유할 수 있어요.</small>
        </div>
      </div>
    </div>
  </header>

  <main id="gallery" class="gallery" aria-live="polite"></main>
  <div class="footer-tip">Tip: 이미지 위에서 마우스 오른쪽 버튼 → “다른 이름으로 저장”으로 개별 저장도 가능합니다.</div>

  <template id="item-template">
    <article class="item">
      <div class="meta">
        <div class="left">
          <span class="name"></span>
          <span>·</span>
          <span class="info"></span>
        </div>
        <div class="actions">
          <button class="btn ghost btn-remove" title="이 항목 삭제">삭제</button>
          <a class="btn ghost btn-download" download title="원본 다운로드">다운로드</a>
        </div>
      </div>
      <img class="preview" loading="lazy" alt="업로드된 이미지 미리보기" />
    </article>
  </template>

  <script>
    const el = {
      input: document.getElementById('file-input'),
      dropzone: document.getElementById('dropzone'),
      gallery: document.getElementById('gallery'),
      sort: document.getElementById('sort-select'),
      clear: document.getElementById('clear-all'),
      toggleCaptions: document.getElementById('toggle-captions'),
      exportBtn: document.getElementById('export-html'),
      itemTemplate: document.getElementById('item-template')
    };

    /** @type {Array<{id:string, name:string, size:number, type:string, dataUrl:string, added:number, width?:number, height?:number}>} */
    let items = [];
    let showCaptions = true;

    const humanBytes = n => {
      if (n < 1024) return n + ' B';
      const u = ['KB','MB','GB','TB'];
      let i = -1; do { n = n/1024; i++; } while (n >= 1024 && i < u.length-1);
      return n.toFixed(n<10?2:n<100?1:0) + ' ' + u[i];
    };

    function addFiles(fileList){
      const arr = Array.from(fileList).filter(f => f.type.startsWith('image/'));
      if(arr.length === 0) return;
      const promises = arr.map(file => new Promise(resolve => {
        const reader = new FileReader();
        reader.onload = () => resolve({
          id: crypto.randomUUID(), name:file.name, size:file.size, type:file.type, dataUrl: reader.result, added: Date.now()
        });
        reader.readAsDataURL(file);
      }));
      Promise.all(promises).then(newItems => {
        items = items.concat(newItems);
        render();
      });
    }

    function render(){
      // sort
      const sorted = [...items];
      const key = el.sort.value;
      sorted.sort((a,b)=>{
        if(key==='name') return a.name.localeCompare(b.name);
        if(key==='size') return a.size - b.size;
        return a.added - b.added; // added
      });

      // clear
      el.gallery.innerHTML = '';

      // build
      for(const it of sorted){
        const node = el.itemTemplate.content.cloneNode(true);
        const article = node.querySelector('.item');
        const nameEl = node.querySelector('.name');
        const infoEl = node.querySelector('.info');
        const imgEl = node.querySelector('.preview');
        const dlBtn = node.querySelector('.btn-download');
        const rmBtn = node.querySelector('.btn-remove');

        nameEl.textContent = it.name;
        infoEl.textContent = humanBytes(it.size);
        if(!showCaptions){ article.querySelector('.meta').style.display='none'; }

        imgEl.src = it.dataUrl;
        imgEl.addEventListener('load', ()=>{
          it.width = imgEl.naturalWidth; it.height = imgEl.naturalHeight;
          infoEl.textContent = `${humanBytes(it.size)} · ${it.width}×${it.height}`;
        }, {once:true});

        dlBtn.href = it.dataUrl;
        dlBtn.download = it.name;
        rmBtn.addEventListener('click', ()=>{
          items = items.filter(x=>x.id!==it.id);
          render();
        });

        el.gallery.appendChild(node);
      }

      // empty state
      if(items.length === 0){
        const empty = document.createElement('div');
        empty.className = 'panel';
        empty.style.textAlign = 'center';
        empty.style.padding = '40px';
        empty.innerHTML = '<div style="font-weight:700; font-size:18px">아직 업로드된 이미지가 없어요</div><div class="sub">위로 이미지를 끌어오거나 “파일 선택”을 눌러 업로드하세요.</div>';
        el.gallery.appendChild(empty);
      }
    }

    function exportAsSelfContainedHTML(){
      if(items.length===0){
        alert('내보낼 이미지가 없습니다. 먼저 이미지를 업로드하세요.');
        return;
      }
      // 최소한의 viewer를 포함한 HTML 문자열 생성
      const now = new Date();
      const safe = s=>s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
      const imagesJson = JSON.stringify(items.map(x=>({name:x.name,size:x.size,type:x.type,dataUrl:x.dataUrl}))); // width/height 생략 가능

      const html = `<!DOCTYPE html>
<html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>공유용 이미지 갤러리</title>
<style>
body{margin:0;background:#0b1220;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,\"Noto Sans KR\"}
.header{position:sticky;top:0;padding:12px 16px;background:rgba(11,18,32,.8);backdrop-filter:blur(6px);border-bottom:1px solid #1f2937}
.wrap{max-width:1000px;margin:0 auto}
.h1{font-weight:800;margin:0}
.sub{color:#9aa4b2;font-size:13px}
.gallery{max-width:1000px;margin:16px auto 36px;display:flex;flex-direction:column;gap:12px;padding:0 16px}
.item{background:#111827;border:1px solid #1f2937;border-radius:16px;overflow:hidden}
.meta{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px 12px;border-bottom:1px dashed #1f2937;color:#9aa4b2;font-size:12px}
.name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60vw}
.preview{display:block;width:100%;height:auto;background:#000}
</style>
</head>
<body>
  <div class="header"><div class="wrap"><h1 class="h1">공유용 이미지 갤러리</h1><div class="sub">이 파일 하나면 충분합니다 · 생성일: ${now.toLocaleString()}</div></div></div>
  <main id="gallery" class="gallery"></main>
  <script>
    const humanBytes = n => { if(n<1024) return n+' B'; const u=['KB','MB','GB','TB']; let i=-1; do{n=n/1024;i++;}while(n>=1024&&i<u.length-1); return n.toFixed(n<10?2:n<100?1:0)+' '+u[i]; };
    const data = ${imagesJson};
    const g = document.getElementById('gallery');
    data.forEach(it=>{
      const art = document.createElement('article'); art.className='item';
      art.innerHTML = '<div class="meta"><span class="name">'+it.name+'</span><span>'+humanBytes(it.size)+'</span></div>' + '<img class="preview" loading="lazy" alt="이미지"/>';
      art.querySelector('img').src = it.dataUrl; g.appendChild(art);
    });
  <\/script>
</body></html>`;

      const blob = new Blob([html], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = '공유용_이미지_갤러리.html';
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 500);
    }

    // Event wiring
    el.input.addEventListener('change', e=> addFiles(e.target.files));

    ;['dragenter','dragover'].forEach(evt => el.dropzone.addEventListener(evt, e=>{
      e.preventDefault(); e.stopPropagation(); el.dropzone.classList.add('highlight');
    }));
    ;['dragleave','drop'].forEach(evt => el.dropzone.addEventListener(evt, e=>{
      e.preventDefault(); e.stopPropagation(); el.dropzone.classList.remove('highlight');
    }));
    el.dropzone.addEventListener('drop', e=>{
      const files = e.dataTransfer?.files; if(files) addFiles(files);
    });

    el.sort.addEventListener('change', render);
    el.clear.addEventListener('click', ()=>{ if(confirm('모든 이미지를 목록에서 제거할까요? 원본 파일에는 영향이 없습니다.')){ items = []; render(); }});
    el.toggleCaptions.addEventListener('click', ()=>{ showCaptions = !showCaptions; el.toggleCaptions.textContent = showCaptions? '파일 정보 숨기기' : '파일 정보 보이기'; render(); });
    el.exportBtn.addEventListener('click', exportAsSelfContainedHTML);

    // 초기 상태 렌더링
    render();
  </script>
</body>
</html>
